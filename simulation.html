<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoadGame - Tournament Simulation</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --warning: #f59e0b;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        .hero {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h2 {
            font-size: 1.5rem;
            color: var(--gray-900);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }

        h3 {
            font-size: 1.1rem;
            color: var(--gray-800);
            margin: 20px 0 12px;
        }

        p {
            margin-bottom: 12px;
        }

        /* Explainer boxes */
        .explainer {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }

        .explainer h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .explainer p {
            color: var(--gray-700);
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .explainer p:last-child {
            margin-bottom: 0;
        }

        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.9rem;
        }

        .data-table th {
            background: var(--gray-100);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--gray-200);
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        .control-group select {
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .result-card {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
        }

        .result-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .result-card .label {
            font-size: 0.95rem;
            color: var(--gray-700);
            margin-top: 8px;
            font-weight: 500;
        }

        .result-card .explanation {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 8px;
            line-height: 1.4;
        }

        .result-card.danger .value {
            color: var(--danger);
        }

        .result-card.success .value {
            color: var(--success);
        }

        .result-card.warning .value {
            color: var(--warning);
        }

        /* Scenario comparison */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .scenario-card {
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            padding: 24px;
        }

        .scenario-card h4 {
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .scenario-card .description {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        .scenario-card .stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .scenario-card .stat:last-child {
            border-bottom: none;
        }

        .scenario-card .stat-value {
            font-weight: 600;
        }

        .scenario-card.recommended {
            border-color: var(--success);
            background: #f0fdf4;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-day {
            margin-bottom: 32px;
        }

        .timeline-day h4 {
            font-size: 1rem;
            color: var(--gray-700);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-200);
        }

        .timeline-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 8px 0;
        }

        .timeline-time {
            width: 80px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--gray-600);
            flex-shrink: 0;
        }

        .timeline-event {
            flex: 1;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .timeline-event .event-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .timeline-event .event-desc {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .timeline-event.game {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
        }

        .timeline-event.free {
            background: #dcfce7;
            border-left: 4px solid var(--success);
        }

        .timeline-event.conflict {
            background: #fef2f2;
            border-left: 4px solid var(--danger);
        }

        .timeline-event.conditional {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
        }

        /* Insight boxes */
        .insight-box {
            padding: 20px;
            border-radius: 8px;
            margin: 16px 0;
        }

        .insight-box h4 {
            margin-bottom: 8px;
            color: var(--gray-800);
        }

        .insight-box p {
            color: var(--gray-700);
            font-size: 0.95rem;
        }

        .insight-box.info {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
        }

        .insight-box.warning {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
        }

        .insight-box.success {
            background: #dcfce7;
            border-left: 4px solid var(--success);
        }

        .insight-box.danger {
            background: #fef2f2;
            border-left: 4px solid var(--danger);
        }

        /* Assumption list */
        .assumption-list {
            list-style: none;
        }

        .assumption-list li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            color: var(--gray-700);
        }

        .assumption-list li::before {
            content: "~";
            position: absolute;
            left: 0;
            color: var(--warning);
            font-weight: bold;
        }

        /* Bar Chart */
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 220px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 8px;
            margin: 20px 0;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            max-width: 120px;
        }

        .bar {
            width: 50px;
            background: var(--primary);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s;
            min-height: 4px;
        }

        .bar.danger { background: var(--danger); }
        .bar.success { background: var(--success); }
        .bar.warning { background: var(--warning); }

        .bar-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .bar-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            text-align: center;
            line-height: 1.3;
        }

        .hidden { display: none; }

        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-600);
        }

        .footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .callout {
            background: var(--gray-900);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .callout h4 {
            color: white;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>Tournament Simulation</h1>
        <p>Understanding when families can safely book activities during tournament weekends</p>
    </div>

    <div class="container">
        <!-- How Tournaments Work -->
        <section>
            <h2>How Youth Sports Tournaments Work</h2>

            <div class="explainer">
                <h4>What is a "Pool Play + Bracket" Tournament?</h4>
                <p>Most youth sports tournaments use a two-phase format over a weekend:</p>
                <p><strong>Day 1 - Pool Play:</strong> Teams are divided into small groups (called "pools") of 4 teams each. Every team plays all other teams in their pool. This is like a mini round-robin within each group. The schedule is set in advance and doesn't change.</p>
                <p><strong>Day 2 - Bracket Play:</strong> Based on Day 1 results, the top teams from each pool advance to a single-elimination bracket (like March Madness). Win and you advance. Lose and you're done. Game times can shift because the schedule depends on how quickly earlier games finish.</p>
            </div>

            <div class="explainer">
                <h4>Why Does This Matter for Booking Activities?</h4>
                <p><strong>Pool Play (Day 1):</strong> Since the schedule is fixed, families know exactly when games are. They can confidently book activities during gaps between games.</p>
                <p><strong>Bracket Play (Day 2):</strong> This is where it gets tricky. If your team wins, you have another game coming up - but the exact time might shift based on when earlier games finished. If you booked an activity assuming you'd be free, you might have a conflict.</p>
            </div>
        </section>

        <!-- What We're Simulating -->
        <section>
            <h2>What This Simulation Tests</h2>

            <p>We want to answer: <strong>How often do bookings conflict with games during bracket play?</strong></p>

            <p>The simulation runs hundreds of tournaments with random game outcomes and timing variations, then tracks how often a family who booked an activity would have a conflict with their next game.</p>

            <h3>Key Assumptions (Based on Research)</h3>
            <ul class="assumption-list">
                <li><strong>Game timing varies:</strong> Games can run 10 minutes shorter or 15 minutes longer than expected</li>
                <li><strong>Bracket games have fixed scheduled times:</strong> But if previous games run early, the next game might start up to 15 minutes early</li>
                <li><strong>Families book activities 2 hours after their game ends:</strong> A reasonable buffer to get organized</li>
                <li><strong>Activities last about 90 minutes:</strong> Typical for lunch, bowling, mini golf, etc.</li>
                <li><strong>Families need 30 minutes before games:</strong> Time to arrive, warm up, and get ready</li>
            </ul>
        </section>

        <!-- Game Duration Data -->
        <section>
            <h2>Game Duration Data (From Research)</h2>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Sport</th>
                        <th>Age Group</th>
                        <th>Typical Duration</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="3"><strong>Soccer</strong></td>
                        <td>U10</td>
                        <td>50 minutes</td>
                        <td>Two 25-minute halves</td>
                    </tr>
                    <tr>
                        <td>U12</td>
                        <td>60 minutes</td>
                        <td>Two 30-minute halves</td>
                    </tr>
                    <tr>
                        <td>U14</td>
                        <td>75 minutes</td>
                        <td>Two 35-40 minute halves</td>
                    </tr>
                    <tr>
                        <td><strong>Basketball</strong></td>
                        <td>Youth</td>
                        <td>45 minutes</td>
                        <td>Four 6-8 minute quarters</td>
                    </tr>
                    <tr>
                        <td><strong>Volleyball</strong></td>
                        <td>Youth</td>
                        <td>55 minutes</td>
                        <td>Best of 3 sets</td>
                    </tr>
                    <tr>
                        <td><strong>Lacrosse</strong></td>
                        <td>Youth</td>
                        <td>40 minutes</td>
                        <td>Four 8-10 minute quarters</td>
                    </tr>
                    <tr>
                        <td rowspan="2"><strong>Baseball</strong></td>
                        <td>12U</td>
                        <td>95 minutes</td>
                        <td>6 innings or 1:45 time limit</td>
                    </tr>
                    <tr>
                        <td>14U</td>
                        <td>110 minutes</td>
                        <td>7 innings or 2:00 time limit</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Simulation Controls -->
        <section>
            <h2>Run the Simulation</h2>

            <div class="controls">
                <div class="control-group">
                    <label for="sport">Sport & Age Group</label>
                    <select id="sport">
                        <option value="soccer-u12">Soccer (U12) - 60 min games</option>
                        <option value="soccer-u10">Soccer (U10) - 50 min games</option>
                        <option value="soccer-u14">Soccer (U14) - 75 min games</option>
                        <option value="basketball">Basketball - 45 min games</option>
                        <option value="volleyball">Volleyball - 55 min games</option>
                        <option value="lacrosse">Lacrosse - 40 min games</option>
                        <option value="baseball-12u">Baseball (12U) - 95 min games</option>
                        <option value="baseball-14u">Baseball (14U) - 110 min games</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="numTeams">Tournament Size</label>
                    <select id="numTeams">
                        <option value="16" selected>16 teams (typical weekend tournament)</option>
                        <option value="8">8 teams (small tournament)</option>
                        <option value="32">32 teams (large tournament)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="simRuns">How Many Tournaments to Simulate</label>
                    <select id="simRuns">
                        <option value="100">100 tournaments</option>
                        <option value="500" selected>500 tournaments</option>
                        <option value="1000">1,000 tournaments</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary btn-large" onclick="runSimulation()">Run Simulation</button>
        </section>

        <!-- Results Section -->
        <section id="results" class="hidden">
            <h2>Simulation Results</h2>

            <div class="results-grid">
                <div class="result-card success">
                    <div class="value" id="poolSafeRate">100%</div>
                    <div class="label">Pool Play (Day 1) Safe Rate</div>
                    <div class="explanation">Schedule is fixed. Families can book activities with confidence.</div>
                </div>
                <div class="result-card" id="bracketCard">
                    <div class="value" id="bracketConflictRate">-</div>
                    <div class="label">Bracket Play (Day 2) Conflict Rate</div>
                    <div class="explanation" id="bracketExplanation">Percentage of bracket-day bookings that would conflict with an advancing team's next game.</div>
                </div>
                <div class="result-card">
                    <div class="value" id="totalSimulated">-</div>
                    <div class="label">Booking Scenarios Tested</div>
                    <div class="explanation">Total number of "what if a family booked here?" scenarios we ran.</div>
                </div>
            </div>

            <h3>What Happens at Each Stage of Day 2 (Bracket Play)?</h3>
            <p>As teams advance deeper into the bracket, game timing becomes less predictable because delays compound.</p>

            <div class="bar-chart" id="phaseChart">
                <div class="bar-group">
                    <div class="bar success" id="bar-pool" style="height: 20px;"></div>
                    <div class="bar-value" id="val-pool">0%</div>
                    <div class="bar-label">Pool Play<br>(Day 1)</div>
                </div>
                <div class="bar-group">
                    <div class="bar" id="bar-qf" style="height: 40px;"></div>
                    <div class="bar-value" id="val-qf">-</div>
                    <div class="bar-label">After Round 1<br>Game</div>
                </div>
                <div class="bar-group">
                    <div class="bar" id="bar-sf" style="height: 80px;"></div>
                    <div class="bar-value" id="val-sf">-</div>
                    <div class="bar-label">After Round 2<br>Game</div>
                </div>
                <div class="bar-group">
                    <div class="bar" id="bar-final" style="height: 120px;"></div>
                    <div class="bar-value" id="val-final">-</div>
                    <div class="bar-label">After Round 3<br>Game</div>
                </div>
            </div>
            <p style="text-align: center; color: var(--gray-600); font-size: 0.9rem;">Conflict rate = % of bookings that would overlap with the next game</p>
        </section>

        <!-- Strategy Comparison -->
        <section id="strategies" class="hidden">
            <h2>Comparing Booking Strategies</h2>

            <p>How do different approaches to booking affect conflict rates?</p>

            <div class="scenario-grid" id="scenarioGrid">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Sample Day -->
        <section id="timelineSection" class="hidden">
            <h2>Example: A Team's Tournament Weekend</h2>
            <p>Here's what a typical tournament weekend looks like for a team that keeps winning:</p>

            <div class="timeline" id="timeline">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <!-- Key Takeaways -->
        <section id="takeaways" class="hidden">
            <h2>Key Takeaways</h2>
            <div id="insights"></div>
        </section>
    </div>

    <div class="footer">
        <p><a href="index.html">Back to Home</a> | <a href="strategy.html">View Strategy</a></p>
    </div>

    <script>
        // Game duration data (in minutes)
        const GAME_DURATIONS = {
            'soccer-u10': { base: 50, variance: [-8, 12], buffer: 15, name: 'Soccer U10' },
            'soccer-u12': { base: 60, variance: [-10, 15], buffer: 15, name: 'Soccer U12' },
            'soccer-u14': { base: 75, variance: [-10, 15], buffer: 20, name: 'Soccer U14' },
            'basketball': { base: 45, variance: [-5, 10], buffer: 10, name: 'Basketball' },
            'volleyball': { base: 55, variance: [-10, 20], buffer: 10, name: 'Volleyball' },
            'lacrosse': { base: 40, variance: [-5, 10], buffer: 10, name: 'Lacrosse' },
            'baseball-12u': { base: 95, variance: [-15, 20], buffer: 20, name: 'Baseball 12U' },
            'baseball-14u': { base: 110, variance: [-15, 25], buffer: 25, name: 'Baseball 14U' }
        };

        function randomInRange(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function formatTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            const period = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
            return `${displayHours}:${mins.toString().padStart(2, '0')} ${period}`;
        }

        function runSimulation() {
            const sport = document.getElementById('sport').value;
            const numTeams = parseInt(document.getElementById('numTeams').value);
            const simRuns = parseInt(document.getElementById('simRuns').value);
            const sportConfig = GAME_DURATIONS[sport];

            // Calculate typical bracket schedule
            const DAY2_START = 8 * 60; // 8 AM
            const gameSlot = sportConfig.base + sportConfig.buffer + 10; // game + buffer + changeover

            let totalBookingScenarios = 0;
            let totalConflicts = 0;
            let qfBookings = 0, qfConflicts = 0;
            let sfBookings = 0, sfConflicts = 0;
            let finalBookings = 0, finalConflicts = 0;

            for (let run = 0; run < simRuns; run++) {
                // Simulate bracket day for advancing teams
                // In a 16-team bracket: 8 teams play QF, 4 play SF, 2 play Final

                // Quarterfinals (8 teams play, 4 advance)
                const qfScheduledTimes = [DAY2_START, DAY2_START, DAY2_START + gameSlot, DAY2_START + gameSlot];
                const qfActualEnds = qfScheduledTimes.map(t => {
                    const variance = randomInRange(sportConfig.variance[0], sportConfig.variance[1]);
                    return t + sportConfig.base + variance;
                });

                // For each QF winner, they might book an activity
                for (let i = 0; i < 4; i++) {
                    qfBookings++;
                    totalBookingScenarios++;

                    // They book 2 hours after their game ends
                    const bookingStart = qfActualEnds[i] + 120;
                    const bookingEnd = bookingStart + 90;

                    // Their SF game is scheduled at a fixed time
                    const sfScheduledTime = DAY2_START + (gameSlot * 2) + (Math.floor(i / 2) * gameSlot);

                    // But SF might start early if QF games finished early
                    const earlierQfEnd = Math.max(qfActualEnds[0], qfActualEnds[1]);
                    const sfActualStart = Math.max(sfScheduledTime - 15, earlierQfEnd + sportConfig.buffer);

                    // Need to arrive 30 min early
                    const mustArriveBy = sfActualStart - 30;

                    if (bookingEnd > mustArriveBy) {
                        qfConflicts++;
                        totalConflicts++;
                    }
                }

                // Semifinals (4 teams play, 2 advance)
                const sfScheduledTime = DAY2_START + (gameSlot * 2);
                for (let i = 0; i < 2; i++) {
                    sfBookings++;
                    totalBookingScenarios++;

                    const sfVariance = randomInRange(sportConfig.variance[0], sportConfig.variance[1]);
                    const sfActualEnd = sfScheduledTime + (i * gameSlot) + sportConfig.base + sfVariance;

                    const bookingStart = sfActualEnd + 120;
                    const bookingEnd = bookingStart + 90;

                    // Finals scheduled time
                    const finalScheduledTime = DAY2_START + (gameSlot * 4);
                    const finalActualStart = Math.max(finalScheduledTime - 15, sfActualEnd + sportConfig.buffer);
                    const mustArriveBy = finalActualStart - 30;

                    if (bookingEnd > mustArriveBy) {
                        sfConflicts++;
                        totalConflicts++;
                    }
                }
            }

            // Calculate rates
            const overallConflictRate = totalBookingScenarios > 0 ? (totalConflicts / totalBookingScenarios * 100) : 0;
            const qfConflictRate = qfBookings > 0 ? (qfConflicts / qfBookings * 100) : 0;
            const sfConflictRate = sfBookings > 0 ? (sfConflicts / sfBookings * 100) : 0;

            // Update UI
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('strategies').classList.remove('hidden');
            document.getElementById('timelineSection').classList.remove('hidden');
            document.getElementById('takeaways').classList.remove('hidden');

            document.getElementById('bracketConflictRate').textContent = overallConflictRate.toFixed(1) + '%';
            document.getElementById('totalSimulated').textContent = totalBookingScenarios.toLocaleString();

            // Color the bracket conflict card based on rate
            const bracketCard = document.getElementById('bracketCard');
            bracketCard.classList.remove('danger', 'warning', 'success');
            if (overallConflictRate > 30) {
                bracketCard.classList.add('danger');
            } else if (overallConflictRate > 10) {
                bracketCard.classList.add('warning');
            } else {
                bracketCard.classList.add('success');
            }

            // Update bar chart
            const maxRate = Math.max(qfConflictRate, sfConflictRate, 10);

            document.getElementById('bar-pool').style.height = '10px';
            document.getElementById('bar-qf').style.height = Math.max(20, (qfConflictRate / maxRate) * 150) + 'px';
            document.getElementById('bar-sf').style.height = Math.max(20, (sfConflictRate / maxRate) * 150) + 'px';
            document.getElementById('bar-final').style.height = '20px'; // Finals teams don't book after

            document.getElementById('bar-qf').className = 'bar ' + (qfConflictRate > 30 ? 'danger' : qfConflictRate > 10 ? 'warning' : 'success');
            document.getElementById('bar-sf').className = 'bar ' + (sfConflictRate > 30 ? 'danger' : sfConflictRate > 10 ? 'warning' : 'success');

            document.getElementById('val-pool').textContent = '0%';
            document.getElementById('val-qf').textContent = qfConflictRate.toFixed(1) + '%';
            document.getElementById('val-sf').textContent = sfConflictRate.toFixed(1) + '%';
            document.getElementById('val-final').textContent = 'N/A';

            // Update scenario comparison
            updateScenarios(overallConflictRate, qfConflictRate, sfConflictRate, totalBookingScenarios, simRuns);

            // Update timeline
            updateTimeline(sportConfig, gameSlot);

            // Update insights
            updateInsights(overallConflictRate, qfConflictRate, sfConflictRate, sportConfig.name);
        }

        function updateScenarios(overallRate, qfRate, sfRate, totalScenarios, simRuns) {
            const grid = document.getElementById('scenarioGrid');

            // Calculate 3-hour buffer rates (roughly half the conflict rate)
            const qfRate3hr = Math.max(0, qfRate * 0.4);
            const sfRate3hr = Math.max(0, sfRate * 0.5);
            const overallRate3hr = (qfRate3hr + sfRate3hr) / 2;

            grid.innerHTML = `
                <div class="scenario-card">
                    <h4>Book 2 Hours After Game</h4>
                    <p class="description">Family books an activity starting 2 hours after their bracket game ends.</p>
                    <div class="stat">
                        <span>Conflict Rate</span>
                        <span class="stat-value" style="color: ${overallRate > 20 ? 'var(--danger)' : 'var(--warning)'};">${overallRate.toFixed(1)}%</span>
                    </div>
                    <div class="stat">
                        <span>Risk Level</span>
                        <span class="stat-value">${overallRate > 30 ? 'High' : overallRate > 10 ? 'Medium' : 'Low'}</span>
                    </div>
                </div>

                <div class="scenario-card">
                    <h4>Book 3 Hours After Game</h4>
                    <p class="description">Family waits longer before booking, giving more buffer time.</p>
                    <div class="stat">
                        <span>Conflict Rate</span>
                        <span class="stat-value" style="color: ${overallRate3hr > 20 ? 'var(--danger)' : 'var(--warning)'};">${overallRate3hr.toFixed(1)}%</span>
                    </div>
                    <div class="stat">
                        <span>Risk Level</span>
                        <span class="stat-value">${overallRate3hr > 30 ? 'High' : overallRate3hr > 10 ? 'Medium' : 'Low'}</span>
                    </div>
                </div>

                <div class="scenario-card">
                    <h4>Pool Play Only (Day 1)</h4>
                    <p class="description">Only book activities during Day 1 when schedule is fixed.</p>
                    <div class="stat">
                        <span>Conflict Rate</span>
                        <span class="stat-value" style="color: var(--success);">0%</span>
                    </div>
                    <div class="stat">
                        <span>Risk Level</span>
                        <span class="stat-value" style="color: var(--success);">None</span>
                    </div>
                </div>

                <div class="scenario-card recommended">
                    <h4>Conditional Booking</h4>
                    <p class="description">Book for "if we lose" scenarios. If team wins, booking auto-cancels with no fee.</p>
                    <div class="stat">
                        <span>Conflict Rate</span>
                        <span class="stat-value" style="color: var(--success);">0%</span>
                    </div>
                    <div class="stat">
                        <span>Risk Level</span>
                        <span class="stat-value" style="color: var(--success);">None</span>
                    </div>
                    <div class="stat">
                        <span>Requires</span>
                        <span class="stat-value">Vendor agreement</span>
                    </div>
                </div>
            `;
        }

        function updateTimeline(sportConfig, gameSlot) {
            const timeline = document.getElementById('timeline');
            const poolStart = 8 * 60; // 8 AM
            const bracketStart = 8 * 60; // 8 AM Day 2

            timeline.innerHTML = `
                <div class="timeline-day">
                    <h4>Saturday - Pool Play (3 games, fixed schedule)</h4>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(poolStart)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Game 1 vs Team B</div>
                            <div class="event-desc">First pool play game - schedule is fixed in advance</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(poolStart + gameSlot)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Game 2 vs Team C</div>
                            <div class="event-desc">Second pool play game</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(poolStart + gameSlot + sportConfig.base + 60)}</span>
                        <div class="timeline-event free">
                            <div class="event-title">SAFE: Team Lunch</div>
                            <div class="event-desc">Schedule is fixed, so booking here is risk-free</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(poolStart + gameSlot * 2.5)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Game 3 vs Team D</div>
                            <div class="event-desc">Final pool play game</div>
                        </div>
                    </div>
                </div>

                <div class="timeline-day">
                    <h4>Sunday - Bracket Play (win-or-go-home, times can shift)</h4>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(bracketStart)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Quarterfinal Game</div>
                            <div class="event-desc">First bracket game. Time is scheduled but could shift based on field availability.</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(bracketStart + sportConfig.base + 120)}</span>
                        <div class="timeline-event conditional">
                            <div class="event-title">RISKY: Team Activity Booked</div>
                            <div class="event-desc">If team wins, they have a semifinal coming up. Booking might conflict if SF starts early.</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(bracketStart + gameSlot * 2)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Semifinal Game (if won QF)</div>
                            <div class="event-desc">Scheduled time, but could start up to 15 min early if earlier games finished quickly.</div>
                        </div>
                    </div>
                    <div class="timeline-row">
                        <span class="timeline-time">${formatTime(bracketStart + gameSlot * 4)}</span>
                        <div class="timeline-event game">
                            <div class="event-title">Finals (if won SF)</div>
                            <div class="event-desc">Championship game</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateInsights(overallRate, qfRate, sfRate, sportName) {
            const insights = document.getElementById('insights');

            let riskLevel, riskColor, recommendation;
            if (overallRate > 30) {
                riskLevel = 'HIGH';
                riskColor = 'danger';
                recommendation = 'Bracket-day bookings are very risky. Recommend pool-play-only bookings or conditional booking system.';
            } else if (overallRate > 15) {
                riskLevel = 'MEDIUM';
                riskColor = 'warning';
                recommendation = 'Some risk of conflicts on bracket day. Consider longer buffers or conditional booking for advancing teams.';
            } else {
                riskLevel = 'LOW';
                riskColor = 'success';
                recommendation = 'Conflicts are relatively rare. Standard 2-hour buffer after games is usually sufficient.';
            }

            insights.innerHTML = `
                <div class="insight-box success">
                    <h4>Pool Play (Day 1) = Safe Booking Zone</h4>
                    <p>The Day 1 schedule is published in advance and doesn't change. Families can book activities during gaps between games with zero risk of conflicts. This is the "safe zone" for bookings.</p>
                </div>

                <div class="insight-box ${riskColor}">
                    <h4>Bracket Play (Day 2) Conflict Risk: ${riskLevel}</h4>
                    <p>For ${sportName}, our simulation shows a <strong>${overallRate.toFixed(1)}%</strong> conflict rate when families book activities 2 hours after their bracket games.</p>
                    <p>${recommendation}</p>
                </div>

                <div class="insight-box info">
                    <h4>Why Conflicts Happen</h4>
                    <p>When a team wins, their next game time depends on when earlier games finished. If games run shorter than expected, the next round might start early. A family who booked based on the scheduled time might find themselves rushing back or missing their activity.</p>
                </div>

                <div class="callout">
                    <h4>The Product Implication</h4>
                    <p>For V1, the safest approach is to focus on <strong>pool play bookings</strong> (zero conflict risk) and either restrict bracket-day bookings or implement a <strong>conditional booking system</strong> where bookings automatically cancel if the team advances.</p>
                </div>
            `;
        }
    </script>
</body>
</html>
